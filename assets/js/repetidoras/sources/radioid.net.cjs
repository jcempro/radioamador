async function processarRegistro(o,s){const{state:t,country:e,status:i,city:r,map_info:n,map:a,locator:l,trustee:c,...d}=o;if(!/bra(s|z)il/i.test((e||"").trim())||"active"!==(i||"").toLowerCase())return null;const f=radioUTILs.normalizarEstado(t);if(!f)return null;const p=await radioUTILs.processarNomeCidade(r,f);if(!p)return null;["frequency","offset","color_code","id"].forEach(o=>{null!=d[o]&&(d[o]=parseFloat(d[o])||0)}),d.info={},void 0!==d.frequency&&(d.rx=d.frequency,delete d.frequency),void 0!==d.color_code&&(d.color=d.color_code,delete d.color_code),void 0!==d.ts_linked&&(d.timeslot=converterTimeslot(d.ts_linked),delete d.ts_linked),void 0!==d.id&&(d.info.dmr_id=d.id,delete d.id),void 0!==d.ipsc_network&&(d.info.ipsc=d.ipsc_network,delete d.ipsc_network),void 0!==d.assigned&&(d.info.assigned=d.assigned,delete d.assigned),void 0!==d.callsign&&(d.info.callsign=d.callsign,delete d.callsign),void 0!==d.rx&&void 0!==d.offset&&(d.tx=parseFloat((d.rx+d.offset).toFixed(5)));const u=`${f}:${p}`;return s[u]=(s[u]||0)+1,d.location=[f.toUpperCase(),p],Object.keys(d).forEach(o=>{"string"==typeof d[o]&&"location"!==o&&(d[o]=commom.capitalizar(d[o]))}),{estadoSigla:f,registro:d}}async function run(o,s,t,e=null,i="radioid.net"){try{const r=await s([PATH_FILE,__RPTDR_LNK],i);if("object"!=typeof r||!Array.isArray(r?.rptrs))throw new Error("JSON invÃ¡lido. Esperado objeto com '.rptrs'");const n={},a={},l={totalEstados:0,totalRegistros:0,registrosOriginais:r.rptrs.length,arquivosGerados:[],estadosProcessados:[],contents:{}};for(const o of r.rptrs){const s=await processarRegistro(o,a);if(s){const{estadoSigla:o,registro:t}=s;n[o]||(n[o]=[]),n[o].push(t)}}cacheProcessado=n;for(const[s,e]of Object.entries(n)){const i={};e.forEach(o=>{const t=o.location[1],e=`${s}:${t}`;i[e]=(i[e]||0)+1});const r={};e.forEach(o=>{const t=o.location[1],e=`${s}:${t}`;i[e]>1&&(r[e]=(r[e]||0)+1,o.location.push(r[e]))}),e.sort((o,s)=>o.location[1].localeCompare(s.location[1]));const n=o("",s),a=await t(e,n,s);l.contents[s]=e,l.totalEstados++,l.totalRegistros+=e.length,l.arquivosGerados.push(a),l.estadosProcessados.push(s),console.log(`Estado ${s.toUpperCase()}: ${e.length} registros`)}return console.log(`\nProcessado: ${l.totalEstados} estados, ${l.totalRegistros} registros (original: ${l.registrosOriginais})`),"function"==typeof e&&e(null,l),l}catch(o){throw console.error("Erro ao processar:",o),"function"==typeof e&&e(o,null),o}}const isNODE="undefined"==typeof window,commom=isNODE?require("../../common.main.cjs"):"undefined"!=typeof window?window.commom:globalThis.commom,radioUTILs=isNODE?require("../utils.main.cjs"):"undefined"!=typeof window?window.radioUtils:globalThis.radioUtils,__RPTDR_LNK="https://radioid.net/static/rptrs.json",PATH_FILE="rptrs.json";let cacheProcessado=null;const converterTimeslot=o=>o?o.replace(/TS/gi,"").trim().split(/\s+/).map(o=>parseInt(o,10)).filter(o=>!isNaN(o)&&o>0):[];isNODE&&(module.exports={run:run}),"undefined"!=typeof globalThis&&(globalThis.RPT_SOURCES={...globalThis.RPT_SOURCES?globalThis.RPT_SOURCES:{},rt4d:{run:run}},"undefined"!=typeof window&&(window.RPT_SOURCES=globalThis.RPT_SOURCES));