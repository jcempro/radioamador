async function hybridTableExtractor(e){console.log("üîç Iniciando extra√ß√£o h√≠brida...");let t=await tryJSDOMWithHeaders(e);return t.length>0?(console.log(`‚úÖ Estrat√©gia 1 (JSDOM com cabe√ßalhos): ${t.length} repetidores encontrados`),t):(t=await tryJSDOMSimple(e),t.length>0?(console.log(`‚úÖ Estrat√©gia 2 (DOM simples): ${t.length} repetidores encontrados`),t):(t=await tryRegexWithHeaders(e),t.length>0?(console.log(`‚ö†Ô∏è Estrat√©gia 3 (Regex com cabe√ßalhos): ${t.length} repetidores encontrados`),t):(console.log("‚ùå Nenhuma estrat√©gia funcionou"),[])))}async function tryJSDOMWithHeaders(e){try{const t=cleanHTML(e);let n;if("undefined"!=typeof document){n=(new DOMParser).parseFromString(t,"text/html")}else{const{JSDOM:e}=require("jsdom");n=new e(t).window.document}return await extractWithDOMAndHeaders(n)}catch(e){return console.log("‚ùå Estrat√©gia 1 falhou:",e.message),[]}}async function extractWithDOMAndHeaders(e){const t=[],n=e.querySelectorAll("table");for(const e of n){const n=findHeaderRow(e);if(!n)continue;const r=mapColumns(extractHeaders(n));if(!r.callsign||!r.tx&&!r.rx)continue;const o=Array.from(e.querySelectorAll("tr")).slice(n.rowIndex+1);for(const e of o){const n=Array.from(e.querySelectorAll("td"));if(n.length<Object.keys(r).length)continue;const o=await processRowWithColumnMap(n,r);o&&t.push(o)}if(t.length>0)break}return t}function findHeaderRow(e){const t=Array.from(e.querySelectorAll("tr"));for(let e=0;e<t.length;e++){const n=t[e];if(Array.from(n.querySelectorAll("th, td")).map(e=>e.textContent.trim().toLowerCase().replace(/\s+/g," ")).filter(e=>Object.keys(HEADER_MAPPING).some(t=>e.includes(t.toLowerCase()))).length>=3)return{row:n,rowIndex:e}}return null}function extractHeaders(e){return Array.from(e.row.querySelectorAll("th, td")).map(e=>e.textContent.trim().toLowerCase().replace(/\s+/g," "))}function mapColumns(e){const t={};return e.forEach((e,n)=>{for(const[r,o]of Object.entries(HEADER_MAPPING))if(e.includes(r.toLowerCase())){t[o]=n;break}}),t}async function processRowWithColumnMap(e,t){const n=void 0!==t.callsign?e[t.callsign]?.textContent.trim():"",r=void 0!==t.tx?e[t.tx]?.textContent.trim().replace(",","."):"",o=void 0!==t.rx?e[t.rx]?.textContent.trim().replace(",","."):"",a=void 0!==t.tone?e[t.tone]?.textContent.trim():"",i=void 0!==t.city?e[t.city]?.textContent.trim():"";if(!n||!n.match(/PY[A-Z0-9]{2,}/))return null;const l=parseFloat(r),s=parseFloat(o);if(isNaN(l)||isNaN(s))return null;let c=cleanCityName(i||"Desconhecida");return await Estrutura(s,l,a,n,c)}async function tryJSDOMSimple(e){try{const t=cleanHTML(e);let n;if("undefined"!=typeof document){n=(new DOMParser).parseFromString(t,"text/html")}else{const{JSDOM:e}=require("jsdom");n=new e(t).window.document}return await extractWithDOMSimple(n)}catch(e){return console.log("‚ùå Estrat√©gia 2 falhou:",e.message),[]}}async function extractWithDOMSimple(e){const t=[],n=e.querySelectorAll("table");for(const e of n){const n=Array.from(e.querySelectorAll("tr"));for(const e of n){const n=Array.from(e.querySelectorAll("td"));if(n.length>=6){const e=await scanRowForPatterns(n);e&&t.push(e)}}if(t.length>0)break}return t}async function scanRowForPatterns(e){let t=null,n=null,r=null,o="",a="Desconhecida";return e.forEach((i,l)=>{const s=i.textContent.trim();if(!t){const i=s.match(/(PY[A-Z0-9]{2,}(?:\/\d)?)/);i&&(t=i[1],1===l&&e.length>4&&(n=parseFloat(e[2]?.textContent.replace(",",".")),r=parseFloat(e[3]?.textContent.replace(",",".")),o=e[4]?.textContent.trim()||"",a=cleanCityName(e[5]?.textContent||"Desconhecida")))}const c=s.match(/(\d{3}\.\d{3})/);if(c){const e=parseFloat(c[1]);n?r||(r=e):n=e}o||"OPEN"!==s&&"D-STAR"!==s&&!s.match(/^\d+\.\d+$/)||(o=s),s.length>2&&s.length<50&&!s.match(/PY[A-Z0-9]/)&&!s.match(/\d{3}\.\d{3}/)&&!s.match(/^\d+$/)&&(s.includes("SP")||s.match(/[A-Z][a-z]+/))&&(a=cleanCityName(s))}),t&&n&&r?await Estrutura(r,n,toneText,t,a):null}async function tryRegexWithHeaders(e){try{return await extractWithRegexAndHeaders(e)}catch(e){return console.log("‚ùå Estrat√©gia 3 falhou:",e.message),[]}}async function extractWithRegexAndHeaders(e){const t=[],n=e.match(/<table[^>]*>[\s\S]*?<\/table>/i);if(!n)return t;const r=n[0],o=r.match(/<tr[^>]*>[\s\S]*?<\/tr>/i);if(!o)return t;const a=o[0],i=[],l=/<(?:th|td)[^>]*>([\s\S]*?)<\/(?:th|td)>/gi;let s;for(;null!==(s=l.exec(a));){const e=s[1].replace(/<[^>]*>/g,"").replace(/&nbsp;/g," ").replace(/\s+/g," ").trim().toLowerCase();i.push(e)}const c=mapColumns(i);if(!c.callsign)return t;const d=/<tr[^>]*>([\s\S]*?)<\/tr>/gi;let u;for(;null!==(u=d.exec(r));){if(u[0]===a)continue;const e=u[1],n=[],r=/<(?:td)[^>]*>([\s\S]*?)<\/(?:td)>/gi;let o;for(;null!==(o=r.exec(e));){const e=o[1].replace(/<[^>]*>/g,"").replace(/&nbsp;/g," ").replace(/\s+/g," ").trim();n.push(e)}if(n.length>=Object.keys(c).length){const e=await processRowWithColumnMapRegex(n,c);e&&t.push(e)}}return t}async function processRowWithColumnMapRegex(e,t){const n=void 0!==t.callsign&&e[t.callsign]||"",r=void 0!==t.tx?(e[t.tx]||"").replace(",","."):"",o=void 0!==t.rx?(e[t.rx]||"").replace(",","."):"",a=void 0!==t.tone&&e[t.tone]||"",i=void 0!==t.city&&e[t.city]||"";if(!n||!n.match(/PY[A-Z0-9]{2,}/))return null;const l=parseFloat(r),s=parseFloat(o);if(isNaN(l)||isNaN(s))return null;const c=cleanCityName(i||"Desconhecida");return await Estrutura(s,l,a,n,c)}async function Estrutura(e,t,n,r,o){return{offset:parseFloat((e-t).toFixed(3)),rx:parseFloat(e.toFixed(3)),tx:parseFloat(t.toFixed(3)),tone:parseFloat(n||0).toFixed(2),location:["SP",await radioUTILs.processarNomeCidade(o,"SP")],info:{callsign:r}}}function cleanHTML(e){return e.replace(/<script\b[^<]*(?:(?!<\/script>)<[^<]*)*<\/script>/gis,"").replace(/<style\b[^<]*(?:(?!<\/style>)<[^<]*)*<\/style>/gis,"").replace(/<link[^>]*>/gi,"").replace(/<meta[^>]*>/gi,"").replace(/ on\w+="[^"]*"/g,"").replace(/ style="[^"]*"/g,"").replace(/ class="[^"]*"/g,"").replace(/ id="[^"]*"/g,"").replace(/<!--[\s\S]*?-->/g,"").replace(/\s+/g," ").trim()}function cleanCityName(e){return e.replace(/\s*-\s*SP\s*$/i,"").replace(/\s*SP\s*$/i,"").replace(/^&\w+;/,"").replace(/[^\w\s√Ä-√ø-]/g,"").trim()}async function run(e,t,n,r=null){e("","SP");const o=await commom._GET(fromURL),a=await hybridTableExtractor(o);return console.log("üìä Resultados extra√≠dos:",a.length),a.length>0&&console.log("üìã Exemplo do primeiro item:",JSON.stringify(a[0],null,2)),a}const isNODE="undefined"==typeof window,commom=isNODE?require("../../common.main.cjs"):"undefined"!=typeof window?window.commom:globalThis.commom,radioUTILs=isNODE?require("../utils.main.cjs"):"undefined"!=typeof window?window.radioUtils:globalThis.radioUtils,fromURL="https://www.labre-sp.org.br/diversos.php?xid=48",HEADER_MAPPING={indicativo:"callsign","indicativo mantenedor":"maintainer_callsign","freq.tx":"tx","freq tx":"tx",freq:"tx","off-set":"rx",offset:"rx","freq.rx":"rx","tone mode":"tone",tone:"tone","tone / mode":"tone",mode:"tone","cidade de sp":"city",cidade:"city","licen√ßa anatel atualizada":"license_date","licen√ßa":"license_date","mantenedor operacional":"maintainer",mantenedor:"maintainer","#":"index"};isNODE&&(module.exports={run:run}),"undefined"!=typeof globalThis&&(globalThis.RPT_SOURCES={...globalThis.RPT_SOURCES?globalThis.RPT_SOURCES:{},labresp:{run:run}},"undefined"!=typeof window&&(window.RPT_SOURCES=globalThis.RPT_SOURCES));